---
const base = import.meta.env.BASE_URL || '/';
const slides = [
  { image: `${base}images/slide1.svg`, alt: '圖片1描述', caption: '' },
  { image: `${base}images/slide2.svg`, alt: '圖片2描述', caption: '' },
  { image: `${base}images/slide3.svg`, alt: '圖片3描述', caption: '' },
  { image: `${base}images/slide4.svg`, alt: '圖片4描述', caption: '' },
];
---

<div class="carousel" id="carousel">
  {slides.map((slide, i) => (
    <div class={`slide ${i === 0 ? 'active' : ''}`} data-index={i}>
      <img src={slide.image} alt={slide.alt} loading={i === 0 ? 'eager' : 'lazy'} />
      <div class="caption">{slide.caption}</div>
    </div>
  ))}

  <button class="nav-btn left" aria-label="上一張">&#10094;</button>
  <button class="nav-btn right" aria-label="下一張">&#10095;</button>

  <div class="dots">
    {slides.map((_, i) => (
      <div
        class={`dot ${i === 0 ? 'active' : ''}`}
        data-index={i}
        role="button"
        tabindex="0"
        aria-label={`切換到第 ${i + 1} 張幻燈片`}
      />
    ))}
  </div>
</div>

<style>
.carousel {
  position: relative;
  width: 100%;
  max-width: 320px;
  margin: 0 auto;             /* 水平置中整個容器 */
  overflow: hidden;
  border-radius: 12px;
  background: #d3d7d94d;
  box-shadow: 0 0 16px 4px #00000033;

  display: flex;              /* 讓內部垂直置中 */
  justify-content: center;    /* 水平置中 */
  align-items: center;        /* 垂直置中 */
  aspect-ratio: 16 / 9;       /* 高度自動跟隨寬度比例 */
}

.slide {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: auto;
  height: 100%;
  display: none;
}

.slide.active { display: block; }

.slide img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.caption {
  position: absolute;
  bottom: 12px;
  right: 24px;
  color: white;
  text-shadow: 0 0 8px #000000b3;
  font-size: 1.1rem;
}

.nav-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  color: #505e66;
  mix-blend-mode: difference;
  padding: 8px 12px;
  font-size: 1.5rem;
  cursor: pointer;
  border-radius: 6px;
  user-select: none;
}

.nav-btn:hover { mix-blend-mode: normal; color: #ffffff; }
.nav-btn.left { left: 12px; }
.nav-btn.right { right: 12px; }

.dots {
  position: absolute;
  bottom: 8px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 8px;
}

.dot {
  width: 12px;
  height: 12px;
  background: rgba(255,255,255,0.6);
  border-radius: 50%;
  cursor: pointer;
}

.dot.active { background: #E5AF3A; }
</style>

<script type="module">
(() => {
  const carousel = document.getElementById('carousel');
  const slidesEl = carousel.querySelectorAll('.slide');
  const dots = carousel.querySelectorAll('.dot');
  const total = slidesEl.length;
  let current = 0;
  let timer;

  function showSlide(index) {
    slidesEl.forEach((slide, i) => slide.classList.toggle('active', i === index));
    dots.forEach((dot, i) => dot.classList.toggle('active', i === index));
    current = index;
  }

  function nextSlide() { showSlide((current + 1) % total); }
  function prevSlide() { showSlide((current - 1 + total) % total); }
  function startTimer() { timer = setInterval(nextSlide, 3000); }
  function stopTimer() { clearInterval(timer); }

  carousel.querySelector('.nav-btn.left').addEventListener('click', () => { stopTimer(); prevSlide(); startTimer(); });
  carousel.querySelector('.nav-btn.right').addEventListener('click', () => { stopTimer(); nextSlide(); startTimer(); });

  dots.forEach(dot => {
    dot.addEventListener('click', (e) => {
      stopTimer();
      showSlide(parseInt(e.target.dataset.index));
      startTimer();
    });
  });

  showSlide(0);
  startTimer();
})();
</script>
